
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<%
	layout("/page/tags/js_css_include.html",{}){}
	layout("/page/tags/rende_loading.html",{}){}
	%>
</head>
<body>

	<table id="adminPermissionGrid" title="${parameter.menuName}权限列表"
		class="easyui-datagrid" fit="true" style="width: 90%;"
		pagination="false" rownumbers="true" fitColumns="true" data-options="
			onBeforeLoad:function checkIsLoadData(param){
				return '${parameter.menuId}'!='';
			},
			url:'${basePath}ms/sysMenuPermission/findListData?menuId=${parameter.menuId}'
		"
		singleSelect="true" pageSize="10" toolbar="#toolbar" striped="true">
		<thead>
			<tr>
				<th align='center' field="permissionName" width="40%">权限名称</th>
				<th align='center' field="method" width="40%">方法名称</th>
	 			<th align='center' field="transMap.isDisableName" width="19%">是否禁用</th>
			</tr>
		</thead>
	</table>

	<div id="toolbar">
		<div style="margin-bottom: 5px;">

			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-add" plain="true" onclick="addMenu()">添加</a> <a
				href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-edit" plain="true"
				onclick="addSelectRowFun('adminPermissionGrid',updateMenu);">修改</a> <a
				href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-remove" plain="true"
				onclick="pubDel('adminPermissionGrid','${basePath}ms/sysMenuPermission/del?id=','permissionId');">删除</a>
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-add" plain="true" onclick="addBaseMenuBatch()">批量添加增删改查权限</a>
		</div>
	</div>
	<div id="dlgbutton" class="easyui-dialog" title="添加/修改按钮信息"
		data-options="iconCls:'icon-save'"  closed="true"
		style="width: 400px; height: 410px; padding: 10px"
		 buttons="#dlg-buttons"
	></div>


	<div id="dlg-buttons">
		<a href="#" id="subBtn" class="easyui-linkbutton" onclick="save()">保存</a>
		<a href="#" class="easyui-linkbutton" onclick="closeDialog()">返回</a>
	</div>

</body>

<script type="text/javascript">

	//关闭dialog方法
	function closeDialog() {
		$('#dlgbutton').dialog('close');
	}

	//打开dialog
	function openDialog(url, title) {
		$('#dlgbutton').load(url, function() {
			$('#dlgbutton').dialog('open').dialog('setTitle', title);
			$.parser.parse($('#dlgbutton'));
		});

	}

	// 添加按钮
	function addMenu() {
		var menuId = '${parameter.menuId}';
		if (menuId == '') {
			EalertE("请选择菜单项！");
			return;
		}
		openDialog(
				'${basePath}/b/page-ms-basics-menu/sys_menu_permission_add_update?isEdit=false&menuId=${parameter.menuId}',
				"添加");
	}

	// 修改按钮
	function updateMenu(row) {
		openDialog(
				'${basePath}/b/page-ms-basics-menu/sys_menu_permission_add_update?isEdit=true&menuId=${parameter.menuId}&id='
						+ row.permissionId, "编辑");

	}
	//一键添加增删改查权限
	function addBaseMenuBatch(){
		var menuId = '${parameter.menuId}';
		if (menuId == '') {
			EalertE("请选择菜单项！");
			return;
		}
		$.ajax({
			url : '${basePath}ms/sysMenuPermission/addBaseMenuBatch',
			dataType : 'json',
			type : 'POST',
			data : {
				menuId : menuId
			},
			success : function(data){
				if(data.result){
					Ealert('添加成功');
					reload();
				}else{
					Ealert('添加失败');
				}
			}
		})
	}

	//重新加载
	function reload() {
		$('#adminPermissionGrid').datagrid('load', {
			name : encodeURI($('#user_rel_name').val())
		});
	}
</script>
</html>
