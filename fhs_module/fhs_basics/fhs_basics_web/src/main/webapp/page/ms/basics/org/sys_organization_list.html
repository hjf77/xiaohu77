<html>
<head>
    <%
        layout("/page/tags/js_css_include.html",{}){}
        layout("/page/tags/rende_loading.html",{}){}
    %>
</head>
<body>

<table id="sysOrganizationGrid" title="${parameter.name}子机构列表"
       class="easyui-datagrid" fit="true" style="width: 90%;"
       url="${basePath}ms/sysOrganization/findPage?parentId=${parameter.id}"
       pagination="true" rownumbers="true" fitColumns="true"
       singleSelect="true" pageSize="10" toolbar="#toolbar" striped="true">
    <thead>
    <tr>
        <th align='center' field="name" width="21%">机构名称</th>
        <th align='center' field="transMap.isEnableName" width="8%">状态</th>
        <th align='center' field="transMap.createUserUserName" width="10%">创建人</th>
        <th align='center' field="createTime" width="20%">创建时间</th>
        <th align='center' field="transMap.updateUserUserName" width="10%">修改人</th>
        <th align='center' field="updateTime" width="20%">修改时间</th>
    </tr>
    </thead>
</table>


<div id="toolbar">
    <div style="margin-bottom: 5px;">
        <#shiro name="sysOrganization:add">
        <a href="javascript:void(0)" class="easyui-linkbutton"
           iconCls="icon-add" plain="true" onclick="addOrg()">添加
        </a>
        </#shiro>
        <#shiro name="sysOrganization:update">
        <a href="javascript:void(0)" class="easyui-linkbutton"
           iconCls="icon-edit" plain="true"
           onclick="addSelectRowFun('sysOrganizationGrid',updateOrg);">修改
        </a>
        </#shiro>
        <#shiro name="sysOrganization:del">
        <a href="javascript:void(0)" class="easyui-linkbutton"
           iconCls="icon-remove" plain="true"
           onclick="pubDel('sysOrganizationGrid','${basePath}ms/sysOrganization/del?id=','id',reloadOrgTree);">删除
        </a>
        </#shiro>
    </div>
</div>
<div id="addOrUpdateDialog" class="easyui-dialog" closed="true"
     style="width: 850px; height: 410px; padding: 10px" buttons="#dlg-buttons"></div>
</body>
<div id="dlg-buttons">
    <a href="javascript:void(0);" class="easyui-linkbutton" onclick="save()">保存</a>
    <a href="javascript:void(0);" class="easyui-linkbutton" onclick="closeDialog()">返回</a>
</div>

<script type="text/javascript">

    //添加机构
    function addOrg() {
        var parentId = '${parameter.id}';
        openDialog(
            '${basePath}/b/page-ms-basics-org/sys_organization_add_update?parentId=' + parentId,
            '添加机构');
    }

    //修改机构
    function updateOrg(row) {
        openDialog(
            '${basePath}/b/page-ms-basics-org/sys_organization_add_update?isEdit=true&id=' + row.id, "修改机构");
    }

    //重新加载
    function reload() {
        reloadOrgTree();
        $('#sysOrganizationGrid').datagrid('load', {

        });
    }


    function reloadOrgTree() {
        console.log(parent.document.getElementById('left').contentWindow);
        parent.document.getElementById('left').contentWindow.reloadData();
    }
</script>
</html>
