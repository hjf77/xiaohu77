<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fhs.workflow.dao.WorkFlowInstanceDAO">
	<select id="findForListFromMap" parameterType="java.util.Map"
		resultType="workFlowInstance">
		SELECT id AS id,
		title AS title,
		creator AS creator,
		creator_id AS
		creatorId,
		create_datetime AS createDatetime,
		work_flow_type_id AS
		workFlowTypeId,
		work_flow_id AS workFlowId,
		process_instance_id AS
		processInstanceId,
		form_id AS formId,
		form_key AS formKey,
		extend_json
		AS extendJson,
		CASE WHEN `NAME_` IS NULL THEN '已完成' ELSE `NAME_` END AS
		newTaskName
		FROM
		`t_work_flow_instance` i LEFT JOIN (SELECT
		`PROC_INST_ID_`,`NAME_` FROM `act_ru_task` WHERE `ID_` IN( SELECT
		MAX(`ID_`)

		FROM
		`act_ru_task` GROUP BY PROC_INST_ID_)) t
		ON t.PROC_INST_ID_ = i.`process_instance_id`
		WHERE 1 = 1
		<include refid="sqlWhere" />
		<if test="start!= null and end != null">
			LIMIT ${start}, ${end}
		</if>
	</select>

	<select id="findCountFromMap" parameterType="map" resultType="java.lang.Integer">
		SELECT COUNT(1) AS count FROM t_work_flow_instance WHERE 1 = 1
		<include refid="sqlWhere" />
	</select>

	<sql id="sqlWhere">
		<if test="uUserId != null and uUserId !='' ">
			creator_id=#{uUserId}
		</if>
	</sql>
</mapper>